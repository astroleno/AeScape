background.js:22 Weather Background Service initializing...
background.js:497 AeScape extension updated
background.js:56 Loaded stored data: Object
background.js:240 Updating weather data using Current Weather API for: Shanghai
background.js:298 Weather data updated successfully using Current Weather API
background.js:453 Periodic weather updates enabled (aligned to quarter-hour)
background.js:36 Weather Background Service initialized
ErrorHandler.js:197 [AeScape] 统一错误处理器已初始化
PerformanceMonitor.js:156 [AeScape Performance] 页面性能指标: Object
PerformanceMonitor.js:39 [AeScape] 性能监控已启动
PerformanceMonitor.js:277 [AeScape] 性能监控器已初始化
ConfigManager.js:371 [AeScape] 配置管理器已初始化
ConfigManager.js:80 [AeScape Config] 配置管理器初始化完成
newtab.js:36 AeScape NewTab initializing...
newtab.js:75 [AeScape] 初始化优化模块...
newtab.js:80 [AeScape] 错误处理器已初始化
PerformanceMonitor.js:156 [AeScape Performance] 页面性能指标: Object
PerformanceMonitor.js:39 [AeScape] 性能监控已启动
newtab.js:86 [AeScape] 性能监控器已初始化
ConfigManager.js:80 [AeScape Config] 配置管理器初始化完成
ConfigManager.js:80 [AeScape Config] 配置管理器初始化完成
newtab.js:93 [AeScape] 配置管理器已初始化
VideoResourceManager.js:43 [VideoResourceManager] 视频资源管理器初始化
newtab.js:102 [AeScape] 视频资源管理器已初始化
SmartThemeAdapter.js:80 [SmartThemeAdapter] 智能主题适配器初始化
newtab.js:112 [AeScape] 智能主题适配器已初始化
newtab.js:115 [AeScape] 所有优化模块初始化完成
newtab.js:885 Initializing video module...
weather-video-mapper.js:166 WeatherVideoMapper: 初始化完成
VideoStreamOptimizer.js:42 [VideoStreamOptimizer] 视频流优化器初始化 Object
VideoWeatherManager.js:55 VideoWeatherManager: 初始化完成
VideoIntroAnimation.js:126 VideoIntroAnimation: 双层视频结构创建完成
VideoIntroAnimation.js:63 VideoIntroAnimation: 初始化完成
VideoWeatherManager.js:91 VideoWeatherManager: 管理器初始化完成
weather-video-mapper.js:166 WeatherVideoMapper: 初始化完成
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_4.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_4.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_5.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_7.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_20.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_16.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_22.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_8.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_16.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_5.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_5.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_17.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_16.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_18.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_20.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/Windy_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_10.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_19.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_3.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_10.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/bv/bottomview_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_3.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_4.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_12.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/g/glass_4.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_5.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_5.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_5.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_8.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_9.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_3.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_3.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_3.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_4.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_3.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_4.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_2.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_1.webm
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_2.webm
AnimationCardSystem.js:11 AnimationCardSystem: 初始化完成
WeatherTriggerManager.js:13 WeatherTriggerManager: 初始化完成
VideoTriggerManager.js:30 VideoTriggerManager: 初始化完成 Object
VideoTriggerManager.js:47 VideoTriggerManager: 初始化状态 Object
newtab.js:916 Video trigger manager initialized successfully
newtab.js:946 Video settings loaded: Object
newtab.js:1041 Checking special video triggers...
newtab.js:1078 No special trigger: too_soon
newtab.js:925 Video module initialized successfully
WeatherTriggerManager.js:25 WeatherTriggerManager: 检查天气变化 Object
WeatherTriggerManager.js:37 WeatherTriggerManager: 天气变化触发成功
newtab.js:63 AeScape NewTab initialized successfully
Warning: Don’t paste code into the DevTools Console that you don’t understand or haven’t reviewed yourself. This could allow attackers to steal your identity or take control of your computer. Please type ‘allow pasting’ below and press Enter to allow pasting.
allow pasting
javascript
// 1. 检查所有关键对象是否存在
console.log('=== AeScape 视频系统检查 ===');
console.log('主对象存在:', !!window.aeScape);
console.log('视频管理器:', !!window.aeScape?.videoManager);
console.log('抽卡系统:', !!window.aeScape?.cardSystem);
console.log('天气映射器:', !!WeatherVideoMapper);
console.log('API映射器:', !!WeatherAPIMapper);
console.log('视频触发器:', !!VideoTriggerManager);
console.log('=========================');
VM53:1 Uncaught ReferenceError: javascript is not defined
    at <anonymous>:1:1
(anonymous) @ VM53:1
// 1. 检查所有关键对象是否存在
console.log('=== AeScape 视频系统检查 ===');
console.log('主对象存在:', !!window.aeScape);
console.log('视频管理器:', !!window.aeScape?.videoManager);
console.log('抽卡系统:', !!window.aeScape?.cardSystem);
console.log('天气映射器:', !!WeatherVideoMapper);
console.log('API映射器:', !!WeatherAPIMapper);
console.log('视频触发器:', !!VideoTriggerManager);
console.log('=========================');
VM57:2 === AeScape 视频系统检查 ===
VM57:3 主对象存在: true
VM57:4 视频管理器: true
VM57:5 抽卡系统: true
VM57:6 天气映射器: true
VM57:7 API映射器: true
VM57:8 视频触发器: true
VM57:9 =========================
undefined
// 2. 测试视频映射系统
async function testVideoMapping() {
  console.log('\n🎯 测试视频映射系统');
  
  const mapper = new WeatherVideoMapper();
  const weatherTypes = ['clear', 'cloudy', 'rain', 'snow', 'fog', 'thunderstorm'];
  
  weatherTypes.forEach(weather => {
    const video = mapper.getVideoForWeather(weather);
    console.log(`${weather}:`, {
      path: video.videoPath,
      hasAlpha: video.hasAlpha,
      blendMode: video.blendMode,
      description: video.description
    });
  });
  
  // 测试统计信息
  console.log('映射统计:', mapper.getMappingStats());
}
testVideoMapping();
VM61:3 
🎯 测试视频映射系统
weather-video-mapper.js:166 WeatherVideoMapper: 初始化完成
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: clear, 强度: medium, 视频: video/tab/c/cloudy_21.webm
VM61:10 clear: {path: 'video/tab/c/cloudy_21.webm', hasAlpha: true, blendMode: 'lighten', description: '晴天效果（c文件夹全部视频，lighten模式）'}
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: cloudy, 强度: medium, 视频: video/tab/c/cloudy_3.webm
VM61:10 cloudy: {path: 'video/tab/c/cloudy_3.webm', hasAlpha: true, blendMode: 'lighten', description: '多云效果（c文件夹全部视频，lighten模式）'}
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: rain, 强度: medium, 视频: video/tab/r/rain_8.webm
VM61:10 rain: {path: 'video/tab/r/rain_8.webm', hasAlpha: false, blendMode: 'screen', description: '雨滴效果（包含所有雨天视频，screen模式）'}
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: snow, 强度: medium, 视频: video/tab/s/snow_4.webm
VM61:10 snow: {path: 'video/tab/s/snow_4.webm', hasAlpha: false, blendMode: 'screen', description: '雪花效果（screen模式）'}
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: fog, 强度: medium, 视频: video/tab/f/foggy_3.webm
VM61:10 fog: {path: 'video/tab/f/foggy_3.webm', hasAlpha: true, blendMode: 'lighten', description: '雾天效果（f文件夹专用视频，lighten模式）'}
weather-video-mapper.js:260 WeatherVideoMapper: 选择视频 - 天气: thunderstorm, 强度: medium, 视频: video/tab/t/thunder_2.webm
VM61:10 thunderstorm: {path: 'video/tab/t/thunder_2.webm', hasAlpha: false, blendMode: 'overlay', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
VM61:19 映射统计: {clear: {…}, cloudy: {…}, rain: {…}, snow: {…}, fog: {…}, …}
Promise {<fulfilled>: undefined}
// 3. 测试抽卡系统
async function testCardSystem() {
  console.log('\n🎲 测试抽卡系统');
  
  const cardSystem = window.aeScape?.cardSystem || new AnimationCardSystem();
  const weatherTypes = ['clear', 'cloudy', 'rain', 'snow', 'fog', 'thunderstorm'];
  
  weatherTypes.forEach(weather => {
    console.log(`\n--- ${weather} 抽卡池 ---`);
    const pool = cardSystem.getAnimationPool(weather);
    console.log(`池名称: ${pool?.name || '未找到'}`);
    console.log(`视频数量: ${pool?.videos?.length || 0}`);
    
    if (pool?.videos?.length > 0) {
      // 抽5次卡
      for (let i = 1; i <= 5; i++) {
        const card = cardSystem.drawCard(weather);
        console.log(`第${i}次抽卡:`, {
          id: card.id,
          path: card.path,
          type: card.type,
          description: card.description
        });
      }
    }
  });
}
testCardSystem();
VM65:3 
🎲 测试抽卡系统
VM65:9 
--- clear 抽卡池 ---
VM65:11 池名称: 晴天动画池
VM65:12 视频数量: 8
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'clear', lastVideoId: undefined, consecutiveCount: 0, totalVideos: 8}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'clear', availableVideos: 8, totalWeight: 640}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'clear', videoId: 'clear_001', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'clear_001', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
VM65:18 第1次抽卡: {id: 'clear_001', path: 'video/tab/c/cloudy_4.webm', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'clear', lastVideoId: 'clear_001', consecutiveCount: 1, totalVideos: 8}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'clear', availableVideos: 8, totalWeight: 640}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'clear', videoId: 'clear_005', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'clear_005', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
VM65:18 第2次抽卡: {id: 'clear_005', path: 'video/tab/c/cloudy_20.webm', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'clear', lastVideoId: 'clear_005', consecutiveCount: 1, totalVideos: 8}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'clear', availableVideos: 8, totalWeight: 640}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'clear', videoId: 'clear_007', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'clear_007', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
VM65:18 第3次抽卡: {id: 'clear_007', path: 'video/tab/c/cloudy_22.webm', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'clear', lastVideoId: 'clear_007', consecutiveCount: 1, totalVideos: 8}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'clear', availableVideos: 8, totalWeight: 640}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'clear', videoId: 'clear_004', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'clear_004', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
VM65:18 第4次抽卡: {id: 'clear_004', path: 'video/tab/c/cloudy_7.webm', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'clear', lastVideoId: 'clear_004', consecutiveCount: 1, totalVideos: 8}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'clear', availableVideos: 8, totalWeight: 640}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'clear', videoId: 'clear_007', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'clear_007', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
VM65:18 第5次抽卡: {id: 'clear_007', path: 'video/tab/c/cloudy_22.webm', type: 'normal', description: '晴天效果（c文件夹全部视频，lighten模式）'}
VM65:9 
--- cloudy 抽卡池 ---
VM65:11 池名称: 多云动画池
VM65:12 视频数量: 9
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'cloudy', lastVideoId: 'clear_007', consecutiveCount: 0, totalVideos: 9}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'cloudy', availableVideos: 9, totalWeight: 720}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'cloudy', videoId: 'cloudy_002', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'cloudy_002', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
VM65:18 第1次抽卡: {id: 'cloudy_002', path: 'video/tab/c/cloudy_17.webm', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'cloudy', lastVideoId: 'cloudy_002', consecutiveCount: 1, totalVideos: 9}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'cloudy', availableVideos: 9, totalWeight: 720}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'cloudy', videoId: 'cloudy_007', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'cloudy_007', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
VM65:18 第2次抽卡: {id: 'cloudy_007', path: 'video/tab/c/cloudy_10.webm', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'cloudy', lastVideoId: 'cloudy_007', consecutiveCount: 1, totalVideos: 9}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'cloudy', availableVideos: 9, totalWeight: 720}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'cloudy', videoId: 'cloudy_005', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'cloudy_005', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
VM65:18 第3次抽卡: {id: 'cloudy_005', path: 'video/tab/c/cloudy_20.webm', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'cloudy', lastVideoId: 'cloudy_005', consecutiveCount: 1, totalVideos: 9}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'cloudy', availableVideos: 9, totalWeight: 720}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'cloudy', videoId: 'cloudy_004', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'cloudy_004', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
VM65:18 第4次抽卡: {id: 'cloudy_004', path: 'video/tab/c/cloudy_18.webm', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'cloudy', lastVideoId: 'cloudy_004', consecutiveCount: 1, totalVideos: 9}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'cloudy', availableVideos: 9, totalWeight: 720}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'cloudy', videoId: 'cloudy_004', consecutiveCount: 2}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'cloudy_004', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
VM65:18 第5次抽卡: {id: 'cloudy_004', path: 'video/tab/c/cloudy_18.webm', type: 'normal', description: '多云效果（c文件夹全部视频，lighten模式）'}
VM65:9 
--- rain 抽卡池 ---
VM65:11 池名称: 雨天动画池
VM65:12 视频数量: 7
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'rain', lastVideoId: 'cloudy_004', consecutiveCount: 0, totalVideos: 7}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'rain', availableVideos: 7, totalWeight: 560}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'rain', videoId: 'rain_005', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'rain_005', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
VM65:18 第1次抽卡: {id: 'rain_005', path: 'video/tab/r/rain_4.webm', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'rain', lastVideoId: 'rain_005', consecutiveCount: 1, totalVideos: 7}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'rain', availableVideos: 7, totalWeight: 560}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'rain', videoId: 'rain_001', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'rain_001', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
VM65:18 第2次抽卡: {id: 'rain_001', path: 'video/tab/r/rain_3.webm', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'rain', lastVideoId: 'rain_001', consecutiveCount: 1, totalVideos: 7}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'rain', availableVideos: 7, totalWeight: 560}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'rain', videoId: 'rain_005', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'rain_005', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
VM65:18 第3次抽卡: {id: 'rain_005', path: 'video/tab/r/rain_4.webm', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'rain', lastVideoId: 'rain_005', consecutiveCount: 1, totalVideos: 7}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'rain', availableVideos: 7, totalWeight: 560}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'rain', videoId: 'rain_001', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'rain_001', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
VM65:18 第4次抽卡: {id: 'rain_001', path: 'video/tab/r/rain_3.webm', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'rain', lastVideoId: 'rain_001', consecutiveCount: 1, totalVideos: 7}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'rain', availableVideos: 7, totalWeight: 560}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'rain', videoId: 'rain_004', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'rain_004', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
VM65:18 第5次抽卡: {id: 'rain_004', path: 'video/tab/r/rain_2.webm', type: 'normal', description: '雨滴效果（包含所有雨天视频，screen模式）'}
VM65:9 
--- snow 抽卡池 ---
VM65:11 池名称: 雪天动画池
VM65:12 视频数量: 4
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'snow', lastVideoId: 'rain_004', consecutiveCount: 0, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'snow', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'snow', videoId: 'snow_004', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'snow_004', type: 'normal', description: '雪花效果（screen模式）'}
VM65:18 第1次抽卡: {id: 'snow_004', path: 'video/tab/s/snow_8.webm', type: 'normal', description: '雪花效果（screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'snow', lastVideoId: 'snow_004', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'snow', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'snow', videoId: 'snow_001', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'snow_001', type: 'normal', description: '雪花效果（screen模式）'}
VM65:18 第2次抽卡: {id: 'snow_001', path: 'video/tab/s/snow_2.webm', type: 'normal', description: '雪花效果（screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'snow', lastVideoId: 'snow_001', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'snow', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'snow', videoId: 'snow_003', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'snow_003', type: 'normal', description: '雪花效果（screen模式）'}
VM65:18 第3次抽卡: {id: 'snow_003', path: 'video/tab/s/snow_9.webm', type: 'normal', description: '雪花效果（screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'snow', lastVideoId: 'snow_003', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'snow', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'snow', videoId: 'snow_003', consecutiveCount: 2}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'snow_003', type: 'normal', description: '雪花效果（screen模式）'}
VM65:18 第4次抽卡: {id: 'snow_003', path: 'video/tab/s/snow_9.webm', type: 'normal', description: '雪花效果（screen模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'snow', lastVideoId: 'snow_003', consecutiveCount: 2, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'snow', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'snow', videoId: 'snow_003', consecutiveCount: 3}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'snow_003', type: 'normal', description: '雪花效果（screen模式）'}
VM65:18 第5次抽卡: {id: 'snow_003', path: 'video/tab/s/snow_9.webm', type: 'normal', description: '雪花效果（screen模式）'}
VM65:9 
--- fog 抽卡池 ---
VM65:11 池名称: 雾天动画池
VM65:12 视频数量: 3
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'fog', lastVideoId: 'snow_003', consecutiveCount: 0, totalVideos: 3}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'fog', availableVideos: 3, totalWeight: 240}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'fog', videoId: 'fog_002', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'fog_002', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
VM65:18 第1次抽卡: {id: 'fog_002', path: 'video/tab/f/foggy_2.webm', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'fog', lastVideoId: 'fog_002', consecutiveCount: 1, totalVideos: 3}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'fog', availableVideos: 3, totalWeight: 240}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'fog', videoId: 'fog_002', consecutiveCount: 2}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'fog_002', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
VM65:18 第2次抽卡: {id: 'fog_002', path: 'video/tab/f/foggy_2.webm', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'fog', lastVideoId: 'fog_002', consecutiveCount: 2, totalVideos: 3}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'fog', availableVideos: 3, totalWeight: 240}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'fog', videoId: 'fog_003', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'fog_003', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
VM65:18 第3次抽卡: {id: 'fog_003', path: 'video/tab/f/foggy_1.webm', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'fog', lastVideoId: 'fog_003', consecutiveCount: 1, totalVideos: 3}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'fog', availableVideos: 3, totalWeight: 240}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'fog', videoId: 'fog_002', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'fog_002', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
VM65:18 第4次抽卡: {id: 'fog_002', path: 'video/tab/f/foggy_2.webm', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'fog', lastVideoId: 'fog_002', consecutiveCount: 1, totalVideos: 3}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'fog', availableVideos: 3, totalWeight: 240}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'fog', videoId: 'fog_001', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'fog_001', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
VM65:18 第5次抽卡: {id: 'fog_001', path: 'video/tab/f/foggy_3.webm', type: 'normal', description: '雾天效果（f文件夹专用视频，lighten模式）'}
VM65:9 
--- thunderstorm 抽卡池 ---
VM65:11 池名称: 雷暴动画池
VM65:12 视频数量: 4
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'thunderstorm', lastVideoId: 'fog_001', consecutiveCount: 0, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'thunderstorm', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'thunderstorm', videoId: 'thunderstorm_001', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'thunderstorm_001', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
VM65:18 第1次抽卡: {id: 'thunderstorm_001', path: 'video/tab/t/thunder_2.webm', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'thunderstorm', lastVideoId: 'thunderstorm_001', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'thunderstorm', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'thunderstorm', videoId: 'thunderstorm_002', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'thunderstorm_002', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
VM65:18 第2次抽卡: {id: 'thunderstorm_002', path: 'video/tab/t/thunder_1.webm', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'thunderstorm', lastVideoId: 'thunderstorm_002', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'thunderstorm', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'thunderstorm', videoId: 'thunderstorm_003', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'thunderstorm_003', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
VM65:18 第3次抽卡: {id: 'thunderstorm_003', path: 'video/tab/t/thunder_3.webm', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'thunderstorm', lastVideoId: 'thunderstorm_003', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'thunderstorm', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'thunderstorm', videoId: 'thunderstorm_004', consecutiveCount: 1}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'thunderstorm_004', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
VM65:18 第4次抽卡: {id: 'thunderstorm_004', path: 'video/tab/t/thunder_4.webm', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
AnimationCardSystem.js:197 AnimationCardSystem: 过滤视频 {weatherType: 'thunderstorm', lastVideoId: 'thunderstorm_004', consecutiveCount: 1, totalVideos: 4}
AnimationCardSystem.js:232 AnimationCardSystem: 开始抽卡 {weatherType: 'thunderstorm', availableVideos: 4, totalWeight: 320}
AnimationCardSystem.js:280 AnimationCardSystem: 更新播放历史 {weatherType: 'thunderstorm', videoId: 'thunderstorm_004', consecutiveCount: 2}
AnimationCardSystem.js:244 AnimationCardSystem: 抽中视频 {id: 'thunderstorm_004', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
VM65:18 第5次抽卡: {id: 'thunderstorm_004', path: 'video/tab/t/thunder_4.webm', type: 'normal', description: '雷暴效果（t文件夹专用视频，overlay模式）'}
Promise {<fulfilled>: undefined}
// 4. 完整视频轮播测试（慎用：会播放所有57个视频）
async function fullVideoPlaytest() {
  console.log('\n📹 开始完整视频轮播测试');
  
  if (!window.aeScape?.videoManager) {
    console.error('视频管理器未初始化！');
    return;
  }
  
  const videoManager = window.aeScape.videoManager;
  const cardSystem = window.aeScape.cardSystem;
  const weatherTypes = ['clear', 'cloudy', 'rain', 'snow', 'fog', 'thunderstorm'];
  
  let totalVideos = 0;
  let playedVideos = 0;
  let errors = 0;
  
  // 统计总视频数
  weatherTypes.forEach(weather => {
    const pool = cardSystem.getAnimationPool(weather);
    totalVideos += pool?.videos?.length || 0;
  });
  
  console.log(`总共需要测试 ${totalVideos} 个视频`);
  
  for (const weather of weatherTypes) {
    console.log(`\n🌤️ 测试 ${weather} 类型视频`);
    const pool = cardSystem.getAnimationPool(weather);
    
    if (!pool?.videos?.length) {
      console.warn(`${weather} 没有视频`);
      continue;
    }
    
    for (const video of pool.videos) {
      try {
        console.log(`播放: ${video.path} (${video.description})`);
        
        // 播放视频
        await videoManager.playWeatherVideo(weather, {
          intensity: 'medium',
          useGlass: false,
          useBottomView: false
        });
        
        playedVideos++;
        console.log(`✅ 播放成功 [${playedVideos}/${totalVideos}]`);
        
        // 等待视频播放完成（2秒）
        await new Promise(resolve => setTimeout(resolve, 2000));
        
      } catch (error) {
        errors++;
        console.error(`❌ 播放失败: ${video.path}`, error);
      }
    }
  }
  
  console.log(`\n🎬 轮播测试完成！`);
  console.log(`成功: ${playedVideos}, 失败: ${errors}, 总计: ${totalVideos}`);
  console.log(`成功率: ${((playedVideos / totalVideos) * 100).toFixed(1)}%`);
}

// 警告用户
console.log('⚠️  轮播测试将播放所有57个视频，需要约5分钟');
console.log('⚠️  确认要开始测试请运行: fullVideoPlaytest()');
VM69:65 ⚠️  轮播测试将播放所有57个视频，需要约5分钟
VM69:66 ⚠️  确认要开始测试请运行: fullVideoPlaytest()
undefined
fullVideoPlaytest
async ƒ fullVideoPlaytest() {
  console.log('\n📹 开始完整视频轮播测试');
  
  if (!window.aeScape?.videoManager) {
    console.error('视频管理器未初始化！');
    return;
  }
  
  const videoManager = window.aeScape.videoManage…
// 7. 性能监控和统计
async function performanceMonitor() {
  console.log('\n⚡ 性能监控');
  
  const getMemoryInfo = () => {
    if (performance.memory) {
      const memory = performance.memory;
      return {
        used: Math.round(memory.usedJSHeapSize / 1024 / 1024) + 'MB',
        total: Math.round(memory.totalJSHeapSize / 1024 / 1024) + 'MB',
        limit: Math.round(memory.jsHeapSizeLimit / 1024 / 1024) + 'MB'
      };
    }
    return 'Memory API不可用';
  };
  
  const initialMemory = getMemoryInfo();
  console.log('初始内存:', initialMemory);
  
  // 监控视频播放性能
  if (window.aeScape?.videoManager) {
    console.log('视频管理器状态:', window.aeScape.videoManager.getStatus());
  }
  
  // 性能观察器
  if ('PerformanceObserver' in window) {
    const observer = new PerformanceObserver((list) => {
      list.getEntries().forEach((entry) => {
        if (entry.name.includes('video') || entry.name.includes('webm')) {
          console.log('资源加载:', entry.name, '耗时:', entry.duration + 'ms');
        }
      });
    });
    
    observer.observe({entryTypes: ['resource']});
    
    setTimeout(() => {
      observer.disconnect();
      console.log('停止性能监控');
      console.log('当前内存:', getMemoryInfo());
    }, 30000);
  }
}

performanceMonitor();
VM98:3 
⚡ 性能监控
VM98:18 初始内存: {used: '3MB', total: '5MB', limit: '4096MB'}
VM98:22 视频管理器状态: {isInitialized: true, isPlaying: false, currentWeather: null, currentVideo: null, performance: {…}, …}
Promise {<fulfilled>: undefined}[[Prototype]]: Promise[[PromiseState]]: "fulfilled"[[PromiseResult]]: undefined
// 8. 测试特殊触发器
async function testSpecialTriggers() {
  console.log('\n🧪 测试特殊触发器');
  
  if (!window.aeScape?.videoTriggerManager) {
    console.error('视频触发管理器未初始化！');
    return;
  }
  
  const triggerManager = window.aeScape.videoTriggerManager;
  
  // 获取当前状态
  console.log('当前状态:', triggerManager.getStatus());
  
  // 模拟各种触发条件
  const testScenarios = [
    { type: 'welcome', description: '模拟首次安装' },
    { type: 'settings', description: '模拟设置完成' },
    { type: 'restart', description: '模拟浏览器重启' },
    { type: 'update', description: '模拟扩展更新' }
  ];
  
  for (const scenario of testScenarios) {
    console.log(`\n测试: ${scenario.description}`);
    
    // 设置相应的存储标记
    switch (scenario.type) {
      case 'welcome':
        await chrome.storage.local.set({ shouldShowWelcomeVideo: true });
        break;
      case 'settings':
        await chrome.storage.local.set({ 
          settingsChanged: true, 
          settingsChangeTime: Date.now() 
        });
        break;
      case 'restart':
        triggerManager.state.isFirstTabThisSession = true;
        triggerManager.state.hasTriggeredThisSession = false;
        break;
      case 'update':
        await chrome.storage.local.set({ 
          recentUpdate: true, 
          updateTime: Date.now() 
        });
        break;
    }
    
    // 检查是否应该触发
    const result = await triggerManager.checkShouldTriggerVideo();
    console.log('触发结果:', result);
    
    if (result.shouldTrigger) {
      console.log(`✅ ${scenario.description} 触发成功`);
    } else {
      console.log(`❌ ${scenario.description} 未触发: ${result.reason}`);
    }
  }
  
  // 获取触发历史
  const history = await triggerManager.getTriggerHistory(5);
  console.log('\n触发历史:', history);
}

console.log('🧪 测试特殊触发器: testSpecialTriggers()');
VM102:65 🧪 测试特殊触发器: testSpecialTriggers()
undefined
background.js:240 Updating weather data using Current Weather API for: Shanghai
background.js:298 Weather data updated successfully using Current Weather API
// 一键运行基础测试
async function quickTest() {
  console.log('🚀 开始快速测试...');
  
  // 基础检查
  console.log('1/4 基础检查...');
  testVideoMapping();
  
  // 抽卡测试
  console.log('2/4 抽卡测试...');
  testCardSystem();
  
  // 播放测试（只测试雨天）
  console.log('3/4 播放测试...');
  await testWeatherType('rain', 1);
  
  // 文件检查
  console.log('4/4 文件检查...');
  // await checkVideoFiles(); // 可选：检查所有文件
  
  console.log('✅ 快速测试完成！');
}

console.log('');
console.log('🎮 === AeScape 视频测试控制台 ===');
console.log('quickTest()              - 运行快速测试');
console.log('testWeatherType("rain")  - 测试指定天气');
console.log('fullVideoPlaytest()      - 完整轮播测试');
console.log('checkVideoFiles()        - 检查所有文件');
console.log('testSpecialTriggers()    - 测试特殊触发');
console.log('performanceMonitor()     - 性能监控');
console.log('================================');
VM106:24 
VM106:25 🎮 === AeScape 视频测试控制台 ===
VM106:26 quickTest()              - 运行快速测试
VM106:27 testWeatherType("rain")  - 测试指定天气
VM106:28 fullVideoPlaytest()      - 完整轮播测试
VM106:29 checkVideoFiles()        - 检查所有文件
VM106:30 testSpecialTriggers()    - 测试特殊触发
VM106:31 performanceMonitor()     - 性能监控
VM106:32 ================================
undefined
VM98:39 停止性能监控
VM98:40 当前内存: {used: '4MB', total: '5MB', limit: '4096MB'}
quickTest
async ƒ quickTest() {
  console.log('🚀 开始快速测试...');
  
  // 基础检查
  console.log('1/4 基础检查...');
  testVideoMapping();
  
  // 抽卡测试
  console.log('2/4 抽卡测试...');
  testCardSystem();
  
  // 播放测试（只测试雨天）
  cons…
