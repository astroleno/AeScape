# AeScape Chrome 扩展打包指南

## 📋 打包前检查清单

### 1. 文件结构检查 ✅
```
AeScape/
├── manifest.json               ✅ 扩展配置文件
├── newtab.html                ✅ 新标签页HTML
├── popup.html                 ✅ 弹窗页面HTML
├── README.md                  ✅ 项目说明
├── VIDEO_MAPPING_GUIDE.md     ✅ 视频映射说明
├── OPTIMIZATION_GUIDE.md      ✅ 性能优化说明
├── css/                       ✅ 样式文件
│   ├── content.css
│   ├── newtab.css
│   └── video-intro.css
├── js/                        ✅ JavaScript文件
│   ├── background.js          ✅ 后台服务脚本
│   ├── newtab.js             ✅ 新标签页主脚本
│   ├── popup.js              ✅ 弹窗脚本
│   ├── content.js            ✅ 内容脚本
│   ├── VideoTriggerManager.js ✅ 视频触发管理器 (新增)
│   ├── weather-api-mapper.js  ✅ 天气API映射器 (新增)
│   ├── VideoWeatherManager.js ✅ 视频天气管理器
│   ├── weather-video-mapper.js ✅ 视频映射表 (已更新)
│   └── [其他支持文件...]
├── icon/                      ✅ 图标文件
│   ├── icon16.png
│   ├── icon32.png
│   ├── icon48.png
│   └── icon128.png
└── video/                     ✅ 视频资源
    └── tab/
        ├── bv/ (3个文件)     ✅ 底部视角雨天
        ├── c/  (24个文件)    ✅ 多云/晴天
        ├── f/  (3个文件)     ✅ 雾天
        ├── g/  (4个文件)     ✅ 玻璃效果雨天
        ├── r/  (10个文件)    ✅ 雨天
        ├── s/  (9个文件)     ✅ 雪天
        └── t/  (4个文件)     ✅ 雷暴
```

**总计视频文件：57个**

### 2. 新增功能检查 ✅

#### ✅ 视频映射表更新
- **bv/r/g文件夹** → 全部映射为雨天 (rain)
- **s文件夹** → 雪天 (snow)
- **c文件夹** → 多云/晴天 (cloudy/clear)
- **f文件夹** → 雾天 (fog)
- **t文件夹** → 雷暴 (thunderstorm)

#### ✅ 天气API映射脚本
- 支持OpenWeatherMap API代码映射
- 支持AccuWeather图标代码映射
- 支持天气描述文字映射（中英文）
- 自动检测API类型并智能映射

#### ✅ 视频显示触发器
- **首次安装触发** - 安装后首次打开标签页展示欢迎视频
- **设置完成触发** - API配置、位置设置、视频设置后展示视频
- **浏览器重启触发** - 重启浏览器后首次打开标签页展示视频
- **扩展更新触发** - 扩展更新后展示视频

#### ✅ 视频模块总开关
- 在弹窗设置中新增"天气视频效果"开关
- 支持一键开启/关闭整个视频模块
- 设置变更会触发欢迎视频（如果开启）

### 3. 兼容性检查 ✅

#### Chrome 版本支持
- **Manifest V3** ✅ 
- **最低Chrome版本**: 88+
- **推荐Chrome版本**: 100+

#### 权限配置
```json
{
  "permissions": [
    "storage",        ✅ 本地数据存储
    "geolocation",    ✅ 位置获取
    "activeTab"       ✅ 活动标签页
  ],
  "host_permissions": [
    "https://api.openweathermap.org/*"  ✅ 天气API访问
  ]
}
```

### 4. 性能优化检查 ✅
- 智能视频预加载
- 内存使用监控
- 错误处理机制
- 主题系统优化
- 配置管理统一

## 🚀 打包步骤

### 方法一：Chrome扩展开发者模式（推荐用于测试）

1. **准备文件**
   ```bash
   # 确保在项目根目录
   cd F:\github\AeScape\video_intergration
   
   # 检查必要文件是否存在
   ls manifest.json newtab.html popup.html
   ```

2. **打开Chrome扩展页面**
   - 访问 `chrome://extensions/`
   - 启用"开发者模式"（右上角开关）

3. **加载扩展**
   - 点击"加载已解压的扩展程序"
   - 选择项目文件夹 `F:\github\AeScape\video_intergration`
   - 扩展会自动加载并分配ID

4. **测试功能**
   - 打开新标签页测试新标签页功能
   - 点击扩展图标测试弹窗功能
   - 检查视频播放和天气显示

### 方法二：打包为CRX文件（用于分发）

1. **在开发者模式中打包**
   - 在 `chrome://extensions/` 页面
   - 点击"打包扩展程序"
   - 选择扩展根目录
   - Chrome会生成 `.crx` 文件和 `.pem` 私钥文件

2. **商店上传准备**
   ```bash
   # 创建打包文件夹
   mkdir -p dist/
   
   # 复制必要文件（排除开发文件）
   cp -r css/ dist/
   cp -r icon/ dist/
   cp -r js/ dist/
   cp -r video/ dist/
   cp manifest.json dist/
   cp newtab.html dist/
   cp popup.html dist/
   ```

3. **压缩为ZIP**
   ```bash
   cd dist/
   zip -r ../AeScape-v2.0.0.zip .
   ```

## 🧪 测试检查清单

### 基础功能测试
- [ ] 扩展正常加载，无报错
- [ ] 新标签页正常显示
- [ ] 天气数据正常获取和显示
- [ ] 弹窗正常打开，设置可用

### 视频功能测试
- [ ] 各种天气类型视频正常播放
- [ ] 视频映射正确（雨天、雪天、多云等）
- [ ] 视频模块开关工作正常
- [ ] 特殊触发器正常工作（安装、设置、重启）

### 性能测试
- [ ] 内存使用合理（< 100MB）
- [ ] 视频加载流畅，无卡顿
- [ ] 主题切换流畅
- [ ] 错误处理正常

### 兼容性测试
- [ ] 不同Chrome版本兼容
- [ ] 不同屏幕分辨率适配
- [ ] 深色/浅色主题适配

## 📝 版本信息

- **版本号**: 2.0.0
- **更新时间**: 2024-08-28
- **主要更新**:
  1. 重构视频映射系统，支持新文件夹结构
  2. 新增天气API智能映射
  3. 新增视频特殊触发机制
  4. 新增视频模块总开关
  5. 优化性能和错误处理

## ⚠️ 注意事项

### 文件大小
- 扩展总大小约：~200MB（包含视频文件）
- Chrome商店限制：128MB
- **需要优化**: 考虑压缩视频文件或使用CDN

### 建议优化
1. **视频压缩** - 进一步压缩.webm文件
2. **按需加载** - 实现视频动态下载
3. **CDN存储** - 将视频文件移至云端
4. **文件分包** - 分离核心功能和视频资源

### 商店发布准备
1. 准备应用截图（1280x800）
2. 编写详细的应用描述
3. 设置合适的分类和标签
4. 准备隐私政策说明

## 🎯 发布后续计划

1. **用户反馈收集**
2. **性能监控和优化**
3. **更多天气效果支持**
4. **多语言支持**
5. **自定义设置扩展**