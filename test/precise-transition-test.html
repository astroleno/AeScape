<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>精确过渡测试 - 天景 AeScape</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #00cec9 100%);
      color: white;
      min-height: 100vh;
    }
    
    .background-interface {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      pointer-events: none;
    }
    
    .background-content {
      text-align: center;
      font-size: 48px;
      font-weight: bold;
    }

    .test-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .test-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .test-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .test-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      margin: 30px 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .video-demo {
      position: relative;
      width: 100%;
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      margin: 20px 0;
    }

    .controls {
      text-align: center;
      margin: 20px 0;
    }

    button {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .status {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-weight: 500;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
      transition: width 0.1s ease;
      position: relative;
    }

    .progress-markers {
      position: relative;
      height: 20px;
      margin-top: 10px;
    }

    .marker {
      position: absolute;
      width: 2px;
      height: 20px;
      background: rgba(255, 255, 255, 0.8);
      top: -10px;
    }

    .marker-label {
      position: absolute;
      top: 15px;
      left: -20px;
      font-size: 12px;
      white-space: nowrap;
    }

    .timeline {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      font-size: 14px;
    }

    .phase-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 20px 0;
    }

    .phase {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .phase-title {
      font-weight: 600;
      margin-bottom: 8px;
    }

    .phase-desc {
      font-size: 14px;
      opacity: 0.8;
    }

    .phase.active {
      background: rgba(76, 175, 80, 0.3);
      border: 1px solid rgba(76, 175, 80, 0.5);
    }
  </style>
</head>
<body>
  <!-- 背景界面层 -->
  <div class="background-interface">
    <div class="background-content">
      <div style="font-size: 72px; margin-bottom: 20px;">🌤️</div>
      <div>天景 AeScape</div>
      <div style="font-size: 24px; margin-top: 20px; opacity: 0.8;">视频播放结束后的主界面</div>
    </div>
  </div>
  
  <!-- 开幕视频层 -->
  <div class="intro-video-container" id="intro-video-container">
    <video class="intro-video" id="intro-video" muted playsinline>
      <source src="../video/M01522_2s_2K.webm" type="video/webm">
    </video>
  </div>

  <div class="test-container">
    <div class="test-header">
      <h1 class="test-title">🎬 精确过渡效果测试</h1>
      <p>测试基于视频时长的精确过渡控制</p>
    </div>

    <div class="test-section">
      <h2>📊 过渡阶段</h2>
      <div class="phase-info">
        <div class="phase" id="phase1">
          <div class="phase-title">阶段 1</div>
          <div class="phase-desc">0-50%: 纯黑背景</div>
        </div>
        <div class="phase" id="phase2">
          <div class="phase-title">阶段 2</div>
          <div class="phase-desc">50-67%: Tab出现</div>
        </div>
        <div class="phase" id="phase3">
          <div class="phase-title">阶段 3</div>
          <div class="phase-desc">67-100%: 淡出</div>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>🎮 视频演示</h2>
      <div class="video-demo">
        <p style="text-align: center; margin: 20px 0; font-size: 18px;">
          点击下方按钮开始播放精确过渡动画
        </p>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      
      <div class="progress-markers">
        <div class="marker" style="left: 50%;">
          <div class="marker-label">50%</div>
        </div>
        <div class="marker" style="left: 66.67%;">
          <div class="marker-label">67%</div>
        </div>
      </div>
      
      <div class="timeline">
        <span>0s</span>
        <span id="current-time">0s</span>
        <span id="total-time">0s</span>
      </div>
      
      <div class="status" id="status">
        状态: 准备就绪
      </div>
      
      <div class="controls">
        <button onclick="playVideo()">播放动画</button>
        <button onclick="stopVideo()">停止动画</button>
        <button onclick="resetVideo()">重置动画</button>
      </div>
    </div>

    <div class="test-section">
      <h2>🔧 技术实现</h2>
      <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; font-family: monospace; font-size: 14px;">
        <code>
// 精确的过渡控制逻辑<br>
if (progress < 0.5) {<br>
&nbsp;&nbsp;// 前1/2时间：背景保持纯黑<br>
&nbsp;&nbsp;opacity = 1;<br>
&nbsp;&nbsp;background = #000;<br>
} else if (progress >= 0.5 && progress < 2/3) {<br>
&nbsp;&nbsp;// 1/2到2/3时间：tab逐渐出现<br>
&nbsp;&nbsp;opacity = 1;<br>
&nbsp;&nbsp;background = transparent;<br>
} else if (progress >= 2/3) {<br>
&nbsp;&nbsp;// 最后1/3时间：从100%变到0<br>
&nbsp;&nbsp;opacity = 1 - fadeProgress;<br>
}
        </code>
      </div>
    </div>
  </div>

  <script src="../js/video-intro.js"></script>
  <script>
    let videoAnimation = null;
    let currentPhase = 0;

    function updateStatus(message) {
      document.getElementById('status').textContent = `状态: ${message}`;
    }

    function updateProgress(currentTime, duration) {
      if (duration > 0) {
        const progress = (currentTime / duration) * 100;
        document.getElementById('progress-fill').style.width = progress + '%';
        document.getElementById('current-time').textContent = currentTime.toFixed(2) + 's';
        document.getElementById('total-time').textContent = duration.toFixed(2) + 's';
        
        // 更新阶段指示器
        updatePhaseIndicator(progress);
      }
    }

    function updatePhaseIndicator(progress) {
      const phases = document.querySelectorAll('.phase');
      phases.forEach((phase, index) => {
        phase.classList.remove('active');
      });
      
      if (progress < 50) {
        phases[0].classList.add('active');
        currentPhase = 1;
      } else if (progress >= 50 && progress < 66.67) {
        phases[1].classList.add('active');
        currentPhase = 2;
      } else {
        phases[2].classList.add('active');
        currentPhase = 3;
      }
    }

    function playVideo() {
      // 确保视频动画正确初始化
      if (!videoAnimation) {
        videoAnimation = new VideoIntroAnimation();
      }
      
      // 重置视频状态
      const videoContainer = document.getElementById('intro-video-container');
      const video = document.getElementById('intro-video');
      
      if (videoContainer && video) {
        videoContainer.style.display = 'flex';
        videoContainer.style.opacity = 1;
        videoContainer.classList.remove('video-ready', 'fade-out');
        video.currentTime = 0;
      }
      
      videoAnimation.play();
      updateStatus('开始播放视频动画');
    }

    function stopVideo() {
      if (videoAnimation) {
        videoAnimation.stop();
        updateStatus('停止视频动画');
      }
    }

    function resetVideo() {
      if (videoAnimation) {
        videoAnimation.stop();
        setTimeout(() => {
          playVideo();
          updateStatus('重置并重新播放');
        }, 100);
      }
    }

    // 监听视频进度
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('intro-video');
      
      if (video) {
        video.addEventListener('timeupdate', () => {
          updateProgress(video.currentTime, video.duration);
        });
        
        video.addEventListener('loadedmetadata', () => {
          updateProgress(0, video.duration);
          updateStatus('视频元数据加载完成');
        });
        
        video.addEventListener('canplay', () => {
          updateStatus('视频可以播放');
        });
        
        video.addEventListener('ended', () => {
          updateStatus('视频播放结束');
        });
        
        video.addEventListener('error', (e) => {
          updateStatus('视频加载错误: ' + e.message);
        });
      }
    });

    // 页面加载完成后初始化
    window.addEventListener('load', () => {
      updateStatus('页面加载完成，点击"播放动画"按钮开始测试');
    });
  </script>
</body>
</html>