# AeScape 视频模块开发计划

## 📋 项目概述

将 `video/` 目录下的天气视频文件集成到 Chrome 扩展的新标签页中，实现打开新标签页时前 1.5 秒展示相应的天气视频效果。

## 🎯 核心目标

1. **视频映射系统**：根据天气类型自动选择对应的视频文件
2. **1.5秒展示**：新标签页打开时前1.5秒播放天气视频
3. **平滑过渡**：视频结束后平滑过渡到主界面
4. **模块化设计**：独立模块，便于后续整合到主插件

## 📁 文件结构分析

### 现有资源
```
video/
├── tab/                    # 新标签页视频资源
│   ├── bv/                # 底部视角视频 (bottomview)
│   ├── c/                 # 云层视频 (cloudy) - 带Alpha通道
│   ├── g/                 # 玻璃效果视频 (glass)
│   ├── r/                 # 雨滴视频 (rain)
│   └── s/                 # 雪花视频 (snow)
└── sphere/                # 球形视角视频（暂不使用）
```

### 视频映射表（基于 video-index.md）
| 天气类型 | 视频路径 | 强度/效果 | Alpha通道 |
|---------|---------|----------|-----------|
| clear | 无视频 | - | - |
| cloudy | video/tab/c/cloudy_*.webm | 多云效果 | ✅ |
| rain | video/tab/r/rain_*.webm | 小雨/中雨/大雨 | ❌ |
| snow | video/tab/s/snow_*.webm | 微雪/小雪/大雪 | ❌ |
| fog | 无视频 | - | - |
| thunderstorm | video/tab/r/rain_11.webm | 雷雨 | ❌ |

## 🏗️ 技术架构

### 1. 核心模块设计
```
video_module/
├── VideoWeatherManager.js     # 视频天气管理器（新增）
├── VideoIntroAnimation.js     # 现有动画模块（优化）
├── video-intro.css           # 样式文件（完善）
├── weather-video-mapper.js   # 天气视频映射器（新增）
└── demo.html                 # 测试页面（更新）
```

### 2. 模块职责分工

#### VideoWeatherManager.js
- 根据天气类型选择对应视频
- 管理视频播放状态
- 处理视频加载和错误
- 与主插件天气系统集成

#### weather-video-mapper.js
- 维护天气类型到视频文件的映射关系
- 支持不同强度的天气效果
- 处理Alpha通道视频的特殊效果

#### VideoIntroAnimation.js（优化）
- 集成视频增强显示方法（基于 advice.md）
- 支持双层视频播放（清晰层+光晕层）
- 实现1.5秒精确控制

## 🚀 开发阶段

### 阶段1：基础架构搭建
1. **创建 VideoWeatherManager.js**
   - 实现天气类型到视频的映射逻辑
   - 添加视频预加载功能
   - 实现错误处理机制

2. **创建 weather-video-mapper.js**
   - 基于 video-index.md 建立完整映射表
   - 支持随机选择同类型视频
   - 处理Alpha通道视频的特殊渲染

3. **优化 VideoIntroAnimation.js**
   - 集成 advice.md 中的视频增强技术
   - 实现双层视频播放（清晰层+光晕层）
   - 添加1.5秒精确控制逻辑

### 阶段2：样式和效果优化
1. **完善 video-intro.css**
   - 实现双层视频的CSS样式
   - 添加视频增强效果的样式
   - 优化过渡动画效果

2. **视频增强效果实现**
   - 亮度/对比度增强
   - 发光效果和轮廓加粗
   - 近景大颗粒假前景
   - 径向渐晕效果

### 阶段3：集成测试
1. **创建测试页面**
   - 更新 demo.html 支持所有天气类型
   - 添加视频切换测试功能
   - 实现性能监控

2. **错误处理和兼容性**
   - 视频加载失败的回退方案
   - 不同浏览器的兼容性测试
   - 性能优化和内存管理

### 阶段4：插件集成准备
1. **模块化封装**
   - 确保模块独立性
   - 提供清晰的API接口
   - 编写集成文档

2. **配置系统**
   - 支持用户自定义设置
   - 视频效果的开关控制
   - 性能选项配置

## 🎨 视频增强技术实现

### 基于 advice.md 的核心技术
1. **双层视频播放**
   ```html
   <div class="video-stage">
     <video class="fx-core" src="weather.webm"></video>
     <video class="fx-glow" src="weather.webm"></video>
   </div>
   ```

2. **CSS增强效果**
   - `mix-blend-mode: screen` 混合模式
   - `filter: brightness() contrast() blur()` 滤镜
   - `drop-shadow()` 发光效果

3. **1.5秒峰值增强**
   - 0.2-0.8s 亮度峰值
   - 径向渐晕背景
   - 近景层放大效果

## 📊 性能考虑

### 优化策略
1. **视频预加载**：只预加载当前天气类型的视频
2. **内存管理**：播放结束后及时释放视频资源
3. **压缩优化**：使用WebM格式，控制文件大小
4. **懒加载**：按需加载视频文件

### 兼容性处理
1. **浏览器支持**：检测WebM支持，提供回退方案
2. **移动设备**：适配不同屏幕尺寸
3. **性能检测**：低性能设备禁用视频效果

## 🔧 配置选项

### 用户可配置项
```javascript
const videoConfig = {
  enabled: true,              // 是否启用视频效果
  duration: 1500,             // 视频播放时长（毫秒）
  enhanceEffects: true,       // 是否启用增强效果
  autoPlay: true,             // 自动播放
  fallbackToStatic: true,     // 失败时回退到静态效果
  performanceMode: 'auto'     // 性能模式：auto/quality/speed
};
```

## 📝 测试计划

### 功能测试
1. **天气映射测试**：验证所有天气类型都能正确映射到视频
2. **播放控制测试**：验证1.5秒精确控制
3. **过渡效果测试**：验证视频到主界面的平滑过渡
4. **错误处理测试**：验证视频加载失败的处理

### 性能测试
1. **内存使用**：监控视频播放期间的内存占用
2. **加载时间**：测试视频加载和播放的响应时间
3. **CPU使用**：监控视频播放期间的CPU占用

### 兼容性测试
1. **浏览器兼容性**：Chrome、Firefox、Safari、Edge
2. **设备兼容性**：桌面、平板、手机
3. **网络环境**：不同网络速度下的表现

## 🎯 成功标准

1. **功能完整性**：所有天气类型都有对应的视频效果
2. **性能表现**：视频播放流畅，不影响主界面性能
3. **用户体验**：1.5秒的视频效果增强用户体验
4. **稳定性**：在各种环境下都能稳定运行
5. **可维护性**：代码结构清晰，易于维护和扩展

## 📅 时间规划

- **阶段1**：2-3天（基础架构）
- **阶段2**：1-2天（样式优化）
- **阶段3**：1-2天（测试调试）
- **阶段4**：1天（集成准备）

**总计**：5-8天完成独立模块开发

## 🔄 后续计划

1. **主插件集成**：将视频模块整合到 chrome_store 版本
2. **用户反馈**：收集用户使用反馈，持续优化
3. **功能扩展**：根据需求添加更多视频效果
4. **性能优化**：持续优化性能和用户体验
