import"./modulepreload-polyfill-B5Qt9EMX.js";class r{constructor(){this.isExpanded=!1,this.currentWeather=null,this.currentLocation=null,this.init()}async init(){this.setupEventListeners(),await this.loadWeatherData(),this.setupAutoUpdate()}setupEventListeners(){const e=document.getElementById("weatherBall");e.addEventListener("click",()=>{this.toggleExpand()}),document.addEventListener("click",t=>{!e.contains(t.target)&&this.isExpanded&&this.collapse()}),chrome.runtime&&chrome.runtime.onMessage.addListener(t=>{t.type==="weather.updated"&&this.updateWeatherDisplay(t.data)})}async loadWeatherData(){try{const e=await chrome.runtime.sendMessage({type:"weather.getCurrent"});e.success&&e.data&&(this.currentWeather=e.data,this.updateWeatherDisplay(e.data));const t=await chrome.runtime.sendMessage({type:"location.getCurrent"});t.success&&t.data&&(this.currentLocation=t.data)}catch(e){console.error("加载天气数据失败:",e),this.showError()}}updateWeatherDisplay(e){if(!e)return;const t=Math.round(e.env.temperature),s=e.location.name||"当前位置",n=e.weather.code,o={clear:"☀️",cloudy:"☁️",rain:"🌧️",snow:"❄️",fog:"🌫️",thunderstorm:"⛈️"},d={clear:"晴朗",cloudy:"多云",rain:"下雨",snow:"下雪",fog:"有雾",thunderstorm:"雷暴"};document.getElementById("weatherIcon").textContent=o[n]||"🌤️",document.getElementById("weatherTemp").textContent=`${t}°`,document.getElementById("weatherLocation").textContent=s,document.getElementById("weatherDescription").textContent=d[n]||"未知";const a=e.weather.windSpeedMps||0;e.weather.windDirDeg,document.getElementById("weatherWind").textContent=a>0?`${a.toFixed(1)} m/s`:"无风"}toggleExpand(){const e=document.getElementById("weatherBall");this.isExpanded=!this.isExpanded,this.isExpanded?e.classList.add("expanded"):e.classList.remove("expanded")}collapse(){document.getElementById("weatherBall").classList.remove("expanded"),this.isExpanded=!1}setupAutoUpdate(){setInterval(()=>{this.loadWeatherData()},5*60*1e3)}showError(){document.getElementById("weatherIcon").textContent="❌",document.getElementById("weatherTemp").textContent="--°",document.getElementById("weatherLocation").textContent="加载失败",document.getElementById("weatherDescription").textContent="无法获取天气数据",document.getElementById("weatherWind").textContent="--"}}new r;
