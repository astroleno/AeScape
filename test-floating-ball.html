<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>悬浮球测试页面</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(20px);
    }
    
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
    
    .test-button {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      transition: all 0.2s ease;
    }
    
    .test-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    
    .status {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>天景 AeScape - 悬浮球测试</h1>
    
    <div class="test-section">
      <h3>功能测试</h3>
      <button class="test-button" onclick="testWeatherData()">测试天气数据</button>
      <button class="test-button" onclick="testExtensionAPI()">测试扩展API</button>
      <button class="test-button" onclick="testGeolocation()">测试地理位置</button>
      <button class="test-button" onclick="clearStorage()">清除存储数据</button>
    </div>
    
    <div class="test-section">
      <h3>悬浮球功能</h3>
      <p>悬浮球应该出现在页面右下角，包含以下功能：</p>
      <ul>
        <li>显示当前天气图标和温度</li>
        <li>显示位置名称</li>
        <li>悬停时显示工具提示</li>
        <li>点击显示详细天气信息</li>
        <li>支持拖拽移动位置</li>
        <li>位置自动保存到本地存储</li>
      </ul>
    </div>
    
    <div class="test-section">
      <h3>测试状态</h3>
      <div id="status" class="status">
        等待测试...
      </div>
    </div>
  </div>

  <script>
    function updateStatus(message) {
      const status = document.getElementById('status');
      const timestamp = new Date().toLocaleTimeString();
      status.innerHTML += `<div>[${timestamp}] ${message}</div>`;
      status.scrollTop = status.scrollHeight;
    }

    function testWeatherData() {
      updateStatus('测试天气数据获取...');
      
      if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.sendMessage) {
        chrome.runtime.sendMessage({ type: 'weather.getCurrent' }, (response) => {
          if (response && response.success) {
            updateStatus(`✅ 天气数据获取成功: ${response.data.env.temperature}°C`);
          } else {
            updateStatus(`❌ 天气数据获取失败: ${response?.error || '未知错误'}`);
          }
        });
      } else {
        updateStatus('❌ Chrome扩展API不可用');
      }
    }

    function testExtensionAPI() {
      updateStatus('测试扩展API连接...');
      
      if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
        updateStatus('✅ 扩展API连接正常');
      } else {
        updateStatus('❌ 扩展API连接失败');
      }
    }

    function testGeolocation() {
      updateStatus('测试地理位置功能...');
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            updateStatus(`✅ 地理位置获取成功: ${position.coords.latitude}, ${position.coords.longitude}`);
          },
          (error) => {
            updateStatus(`❌ 地理位置获取失败: ${error.message}`);
          },
          { timeout: 10000 }
        );
      } else {
        updateStatus('❌ 浏览器不支持地理位置功能');
      }
    }

    function clearStorage() {
      updateStatus('清除本地存储数据...');
      
      try {
        localStorage.removeItem('aescape-ball-position');
        updateStatus('✅ 本地存储数据已清除');
      } catch (error) {
        updateStatus(`❌ 清除存储失败: ${error.message}`);
      }
    }

    // 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', () => {
      updateStatus('页面加载完成，悬浮球应该自动初始化');
      
      // 检查扩展是否可用
      setTimeout(() => {
        if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
          updateStatus('✅ 扩展环境检测正常');
        } else {
          updateStatus('⚠️ 扩展环境不可用，悬浮球可能无法正常工作');
        }
      }, 1000);
    });
  </script>
</body>
</html>
